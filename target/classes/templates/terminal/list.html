<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Terminais - Sistema de Terminais</title>
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/css/all.min.css}" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">
    <link rel="icon" type="image/x-icon" th:href="@{/favicon.ico?v=1}" />
</head>
<body>
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container"><a class="navbar-brand" th:href="@{/home}"> <i class="fas fa-desktop"></i> Sistema de
        Terminais Atacadão</a>
        <div class="navbar-nav ms-auto"><a class="nav-link" th:href="@{/logout}"> <i class="fas fa-sign-out-alt"></i>
            Sair </a></div>
    </div>
</nav>
<!-- Conteúdo Principal -->
<div class="container mt-4">
    <!-- Cabeçalho da Página -->
    <div class="d-flex justify-content-between align-items-center mb-4"><h2 class="text-success"><i class="fas fa-desktop text-success"></i> Terminais
    </h2>
        <div><a th:href="@{/home}" class="btn btn-secondary me-2"> <i class="fas fa-arrow-left"></i> Voltar </a> <a
                th:href="@{/terminais/novo}" class="btn btn-primary"> <i class="fas fa-plus"></i> Novo Terminal </a>
        </div>
    </div>
    <!-- Alert de Sucesso -->
    <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert"><i
            class="fas fa-check-circle me-2"></i> <span th:text="${success}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    <!-- Campo de Busca -->
    <div class="card mb-3">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="input-group"><span class="input-group-text">                                <i
                            class="fas fa-search"></i>                            </span> <input type="text"
                                                                                                 id="busca-terminal"
                                                                                                 class="form-control"
                                                                                                 placeholder="Buscar por nome, setor ou localização..."
                                                                                                 data-search></div>
                </div>
                <div class="col-md-6">
                    <div class="d-flex align-items-center">
                        <span class="text-muted me-2">Total:</span>
                        <span class="badge bg-primary" th:text="${terminais.size()}">0</span>
                        <span class="text-muted ms-3 me-2">Ativos:</span> <span class="badge bg-success"
                                                                              th:text="${terminais.?[ativo].size()}">0</span>
                        <span class="text-muted ms-3 me-2">Conteúdo:</span>
                        <span class="text-muted me-2  align-items-right">
                            <a th:href="@{/conteudos?origem=/terminais}" class="badge btn-info" title="Conteúdo">
                                <i class="fa-solid fa-info-circle"></i>
                            </a>
                        </span>
                        <span class="text-muted ms-3 me-2">Agendamento:</span>
                        <span class="text-muted me-2  align-items-right">
                            <a th:href="@{/agendamentos?origem=/terminais}" class="badge btn-secondary" title="Agendamento">
                                <i class="fa-solid fa-calendar"></i>
                            </a>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Tabela de Terminais -->
    <div class="card">
        <div class="card-header"><h5 class="mb-0"><i class="fas fa-list"></i> Lista de Terminais </h5></div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0" id="tabela-terminais">
                    <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Setor</th>
                        <th>Localização</th>
                        <th>Nr</th>
                        <th>URL da API</th>
                        <th>Status</th>
                        <th class="text-center">Ações</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="terminal : ${terminais}">
                        <td><span class="badge bg-light text-dark" th:text="${terminal.id}"></span></td>
                        <td><strong th:text="${terminal.nome}"></strong></td>
                        <td><span th:if="${terminal.categoria}" class="badge bg-info text-dark"
                                  th:text="${terminal.categoria.nome}"></span> <span th:unless="${terminal.categoria}"
                                                                                     class="text-muted fst-italic">Sem categoria</span>
                        </td>
                        <td><i class="fas fa-map-marker-alt text-muted me-1"></i> <span
                                th:text="${terminal.localizacao}"></span></td>
                        <td><span class="badge bg-secondary" th:text="${terminal.nrTerminal}"></span></td>
                        <td>
                            <div class="d-flex align-items-center">
                                <code class="bg-light px-1 py-1 rounded" th:text="'localhost:8080/api-mercado/terminais' + ${terminal.url}"></code>
                                <a th:href="@{'/terminais' + ${terminal.url}}" target="_blank"
                                   class="btn btn-sm btn-outline-success ms-1" title="Testar API"> <i
                                        class="fas fa-external-link-alt"></i> </a></div>
                        </td>
                        <td><span th:if="${terminal.ativo}" class="badge bg-success">                                        <i
                                class="fas fa-check me-1"></i>Ativo                                    </span> <span
                                th:unless="${terminal.ativo}" class="badge bg-danger">                                        <i
                                class="fas fa-times me-1"></i>Inativo                                    </span></td>
                        <td class="text-center">
                            <div class="btn-group" role="group">
                                <a
                                        th:href="@{/terminais/editar/{id}(id=${terminal.id})}"
                                        class="btn btn-sm btn-outline-primary" title="Editar terminal"> <i
                                        class="fas fa-edit"></i>
                                </a>
                                <a th:href="@{/terminais/excluir/{id}(id=${terminal.id})}"
                                   class="btn btn-sm btn-outline-danger"
                                   onclick="return confirmarExclusao('Deseja realmente excluir este terminal? Esta ação não pode ser desfeita.')"
                                   title="Excluir terminal"> <i class="fas fa-trash"></i> </a></div>
                        </td>
                    </tr>
                    <!-- Linha quando não há terminais -->
                    <tr th:if="${#lists.isEmpty(terminais)}" class="text-center">
                        <td colspan="8" class="py-4">
                            <div class="text-muted"><i class="fas fa-inbox fa-3x mb-3"></i>
                                <h5>Nenhum terminal encontrado</h5>
                                <p>Clique em "Novo Terminal" para criar o primeiro terminal.</p></div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- Cards de Resumo (se houver terminais) -->
    <div th:if="${!#lists.isEmpty(terminais)}" class="row mt-4">
        <div class="col-md-3">
            <div class="card text-white bg-primary">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div><h6 class="card-title">Total de Terminais</h6>
                            <h3 th:text="${terminais.size()}">0</h3></div>
                        <div class="align-self-center"><i class="fas fa-desktop fa-2x"></i></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-success">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div><h6 class="card-title">Terminais Ativos</h6>
                            <h3 th:text="${terminais.?[ativo].size()}">0</h3></div>
                        <div class="align-self-center"><i class="fas fa-check-circle fa-2x"></i></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-warning">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div><h6 class="card-title">Setores Diferentes</h6>
                            <h3 th:text="${#sets.toSet(terminais.![categoria.nome]).size()}">0</h3></div>
                        <div class="align-self-center"><i class="fas fa-tags fa-2x"></i></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Modal para Detalhes do Terminal -->
<div class="modal fade" id="modalDetalhes" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header"><h5 class="modal-title"><i class="fas fa-desktop me-2"></i>Detalhes do Terminal
            </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="modal-body-detalhes">
                <!-- Conteúdo será carregado via JavaScript -->                </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>
<!-- Scripts -->
<script th:src="@{/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/js/app.js}"></script>
<script>
    // Função específica para mostrar detalhes do terminal
    function mostrarDetalhes(terminalId) {
        fetch(`/api/terminais/${terminalId}`)
            .then(response => response.json())
            .then(data => {
                const modalBody = document.getElementById('modal-body-detalhes');
                modalBody.innerHTML = `
                        <div class="row">
                        <div class="col-md-6">
                        <h6>Informações Básicas</h6>
                        <table class="table table-sm">
                            <tr><td><strong>ID:</strong></td><td>${data.id}</td></tr>
                            <tr><td><strong>Nome:</strong></td><td>${data.nome}</td></tr>
                            <tr><td><strong>Localização:</strong></td><td>${data.localizacao}</td></tr>
                            <tr><td><strong>Número:</strong></td><td>${data.nrTerminal}</td></tr>
                            <tr><td><strong>Status:</strong></td><td>
                            <span class="badge ${data.ativo ? 'bg-success' : 'bg-danger'}">
                                    ${data.ativo ? 'Ativo' : 'Inativo'}
                            </span>
                            </td>
                            </tr>
                        </table>
                        </div>
                        <div class="col-md-6">
                        <h6>API e Acesso</h6>                                <div class="mb-3">
                                                            <label class="form-label">URL da API:</label>
                                                            <div class="input-group">
                                                            <input type="text" class="form-control"                                                value="localhost:8080/api-mercado/terminais${data.url}" readonly>
                                                            </div>                                </div>                                <div class="mb-3">                                    <a href="/api-mercado/terminais${data.url}" target="_blank" class="btn btn-success">                                        <i class="fas fa-external-link-alt me-2"></i>Testar API                                    </a>                                </div>                            </div>                        </div>                        <div class="row mt-3">                            <div class="col-12">
                        <h6>Setor</h6>                                <div class="card">                                    <div class="card-body">                                        <h6 class="card-title">${data.categoria?.nome || 'Sem categoria'}</h6>                                        <p class="card-text">${data.categoria?.descricao || 'Nenhuma descrição disponível'}</p>                                    </div>                                </div>                            </div>                        </div>                    `;
                const modal = new bootstrap.Modal(document.getElementById('modalDetalhes'));
                modal.show();                })
            .catch(error => {
                    mostrarAlertTemporario('Erro ao carregar detalhes do terminal', 'danger');                });
    }
    // Configurar busca na tabela quando a página carregar
    document.addEventListener('DOMContentLoaded', function()
            {            implementarBusca('busca-terminal', 'tabela-terminais');        });
</script>
</body>
</html>